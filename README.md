### Overview

This repository contains an implementation of the RISE language and its Shine compiler (https://rise-lang.org/).

The source code for the compiler is organised into sub-packages of the `shine` package.

- `DPIA` contains the implementation of Data Parallel Idealised Algol.
  The `Compilation` sub-package contains the implementation to rewrite a
  high-level functional program into an imperative representation.
  Backend specific code generators for C, OpenMP and OpenCL are in their
  own packages.
  A paper describing DPIA is available at (https://arxiv.org/abs/1710.08332).
- `C` contains the C backend printing an imperative DPIA representation into
  C code.
- `OpenMP` contains the OpenMP backend printing an imperative DPIA
  representation into OpenMP code. The C backend is used to print most
  code.
  This package also defines extensions in form of additional patterns
  added to the RISE language and `DPIA`.
- `OpenCL` contains the OpenCL backend printing an imperative DPIA
  representation into OpenCL code.
  This package also defines extensions in form of additional patterns
  added to the RISE language and `DPIA`.

### Setup and Documentation

Please have a look at: https://rise-lang.org/doc/

### Float Safe Optimizer

This repository contains an optimizer executable that preserves floating-point semantics.
To build a Fat JAR executable:

```sh
sbt float_safe_optimizer/assembly
```

To optimize a Rise program and generate code:

```sh
java -Xss20m -Xms512m -Xmx4G -jar float-safe-optimizer.jar $function_name $rise_source_path $output_path
```

For example:

```sh
java -Xss20m -Xms512m -Xmx4G -jar float-safe-optimizer.jar add3 float-safe-optimizer/examples/add3Seq.rise float-safe-optimizer/examples/add3Seq.c
java -Xss20m -Xms512m -Xmx4G -jar float-safe-optimizer.jar add3 float-safe-optimizer/examples/add3.rise float-safe-optimizer/examples/add3.c
```

# Float-Safe Optimizer Analysis

This directory contains scripts to analyze the performance and accuracy tradeoffs between standard floating-point operations and MPFR (Multiple Precision Floating-Point Reliable) implementations.

## Overview

The analysis compares two RISE programs:
1. `sum.rise` - A simple summation operation
2. `mm.rise` - Matrix multiplication

For each program, we examine four different floating-point types:
- **Normal**: Standard floating-point numbers
- **Subnormal**: Very small floating-point numbers that don't follow the normalized format
- **Mixed**: A combination of normal and subnormal numbers
- **Magnitude**: High and low magnitude numbers (potentially causing overflow/underflow)

## Results and Visualizations

The scripts generate two main visualizations:

1. `float_comparison_results.png`: A 2x2 grid showing:
   - Standard execution times
   - MPFR execution times
   - Maximum absolute error (log scale)
   - MPFR slowdown factors

2. `accuracy_vs_performance.png`: A scatter plot showing the tradeoff between:
   - Accuracy (measured by maximum absolute error)
   - Performance (measured by MPFR slowdown factor)

## Key Findings

1. **MPFR Implementation Performance**:
   - Matrix multiplication shows much higher slowdown (avg ~50x) compared to sum (avg ~18x)
   - The absolute execution time increase is more significant for compute-intensive operations

2. **Floating-Point Type Impact**:
   - Subnormal numbers show the best accuracy but with performance tradeoffs
   - Magnitude numbers (high+low) show the worst accuracy, with infinite errors for MM
   - Normal numbers provide a reasonable balance between accuracy and performance

3. **Recommendations**:
   - For high-precision requirements: Use MPFR with Subnormal numbers
   - For balanced performance: Use Standard with Normal numbers
   - Avoid using Magnitude type for numerical stability

## Running the Analysis

To run the analysis and generate visualizations:

```bash
./analyze_results.sh
```

## Requirements

- Python 3
- matplotlib
- numpy

## Data Source

The data was collected by running the `driver_compare` executable generated by the `driver_gen.py` script in the float-safe-optimizer project.
