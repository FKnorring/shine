depFun((n: Nat) => fun((n`.`f32) ->: f32)(in =>
  split(131072)(in) |> // read
  map( // mapSeq/mapPar : read -> write
    asVectorAligned(4) >> // read
    reduceSeq(add)(vectorFromScalar(lf32(0))) >> // read
    makeArray(1) >> // read
    mapSeqUnroll(fun(x => x)) >> // read -> write
    toMem >> // write -> read
    asScalar >> // read
    reduceSeq(add)(lf32(0)) // read : scalar -> write
  ) |>
  toMem |> // write -> read
  reduceSeq(add)(lf32(0)) // read : scalar -> write
))