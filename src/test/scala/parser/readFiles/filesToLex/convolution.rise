identity:=x->x
dotElemWeihts:=weightsA->elem->oclReduceSeqUnroll Private (acc->pair->+ acc (* (fst pair) (snd pair))) 0F32 (zip (join elem) weightsA)
unslide2D:=join .(map ((map join) . transpose))
slide2D:=SzOuter:Nat=>StOuter:Nat=>SzInner:Nat=>StInner:Nat=> (map transpose).(slide SzOuter StOuter).(map (slide SzInner StInner))
padClamp2D:=LOuter:Nat=>ROuter:Nat=>LInner:Nat=>RInner:Nat=>map (padClamp LOuter ROuter) . (padClamp LInner RInner)

blurXTiled2D::N:Nat=>N.N.F32->17.F32->N.N.F32
blurXTiled2D=N:Nat=>matrix->weights->
  unslide2D . (mapWorkGroup 1 (
  mapWorkGroup 0 (
  tile-> mapLocal 1 (( 
  mapLocal 0 (dotElemWeihts weights)
  ). (slide2D 1 1 17 1) 
  (toLocal (mapLocal 1 (mapLocal 0 identity) tile))
  )
  )
  )) . (slide2D 4 4 144 128) . (padClamp2D 0 0 8 8) matrix